<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500,600" rel="stylesheet">
    <title>Line Chart Raw Count Example</title>
    <style>
        .label
        {
            font-family: 'Montserrat',sans-serif;
            font-weight: 500;
            font-size: 15px;
            color:black;
        }

        .container{
            float:left;
        }

    </style>
</head>
<body>

<div class="container" id="franchiseLine"></div>

<div class="container" id="legendDiv"></div>

<script>
    let margin = {top: 2, right: 30, bottom: 30, left: 30},
        width = 600
        height= 600
        chartWidth = width - margin.left - margin.right,
        chartHeight = height - margin.top - margin.bottom;

    let myGraph = d3.select("#franchiseLine")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("id", "rawLineChart")
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    let legends = d3.select("#legendDiv")
        .append("svg")
        .attr('width', 500)
        .attr('height',300)
        .append('g')
        .attr('transform', 'translate(0, 30)')


    d3.csv("franchises_small.csv",d3.autoType).then((data)=>{

       // const filterValues = ["The Lord of the Rings", "The Hobbit"]
       // data = data.filter( d => {  return filterValues.indexOf(d['Franchise']) !== -1})
        console.log(data);
        let dateExtent = d3.extent(data, d=>d.Year);
        console.log(dateExtent)
        let countMax = d3.max(data, d=>d.Count)
        let dateScale = d3.scaleLinear().domain(dateExtent).range([margin.left, chartWidth]);
        let countScale = d3.scaleLinear().domain([0, countMax]).range([chartHeight, 0]);
        let yAxis = d3.axisLeft(countScale).ticks();
        let xAxis = d3.axisBottom(dateScale)
            .tickFormat(d3.format("d"))
            .ticks(20)

        myGraph.append("g")
            .attr("transform","translate(" + margin.left + "," + margin.top + ")")
            .call(yAxis);

        myGraph.append("g")
            .attr("transform", "translate("+ margin.left + "," + chartHeight + ")")
            .call(xAxis);


        //Choose colors for each franchise
        let names = [...new Set(data.map(d => d.Franchise))];
        console.log(names)
        let colorScale = d3.scaleOrdinal().domain(names)
            .range(['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#ffbe33','#a65628','#f781bf','#4ec0c2'])


        let sumstat = d3.group(data, d=>d['Franchise'])
        let keyValue = Array.from(sumstat, ([key, value]) => ({key, value}))

        //Line function to chart the line graph
        let line = d3.line()
            .x(function(d){ return dateScale(+d['Year'])})
            .y(function(d){ return countScale(+d['Count'])})

        let tooltip = d3.select("body")
            .data(keyValue)
            .append("div")
            .attr("class","tooltip")
            .style("position", "absolute")
            //.style("font-family", "'Open Sans', sans-serif")
            //.style("font-size", "12px")
            .style("z-index", "10")
            .style("background-color", "transparent")
            //.style("color","black")
            //.style("border", "solid")
            //.style("border-color", "#A89ED6")
            .style("padding", "5px")
            .style("border-radius", "2px")
            .style("visibility", "hidden");

        tooltip;


        console.log(keyValue)
        // Draw the line
        let svg = d3.select("#rawLineChart")
        svg.selectAll(".line")
            .data(keyValue)
            .enter()
            .append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .append("path")
            .attr("fill", "none")
            .attr("stroke", function(d){ return colorScale(d.key) })
            .attr("stroke-width", 1.5)
            .attr("d", d => line(d.value))
            .on("mouseover", function(d) {
                tooltip.style("visibility", "visible")
                    .text(d.key)
            })

            .on("mousemove", function(event,d) {
                let [x, y] = d3.pointer(event);
                tooltip.style("top", (y+30 ) + "px")
                    .style("left", (x+50 ) + "px")
                    .text(d.key)
            })


            .on("mouseout", function(d) {
                    tooltip.style("visibility", "hidden");
                })



        //add x-axis label
        myGraph.append("text")
            .attr("class","label")
            .attr("text-anchor", "end")
            .attr("x", 600)
            .attr("y", 610)
            .text("Year");

        //add y-axis label
        myGraph.append("text")
            .attr("class","label")
            .attr("text-anchor", "end")
            .attr("y", 15)
            .attr("x", 20)
            .text("Count");



        // //Add svgs for each chart
        // let svg = d3.select("#myDataViz")
        //     .selectAll("uniqueChart")
        //     .data(keyValue)
        //     .enter()
        //     .append("svg")
        //     .attr("width",width)
        //     .attr("height",height)
        //     .append("g").attr("transform",
        //         "translate(" + margin.left + "," + margin.top + ")")
        //     .attr("id", function(d){ return(d.key)});
        //
        // //Put x and y axis
        // svg.append("g")
        //     .call(yAxis);
        // svg.append("g")
        //     .attr("transform", "translate(0," + chartHeight + ")")
        //     .call(d3.axisBottom(dateScale));
        //
        //
        // svg.append("path")
        //     .attr("class", "mean")
        //     .attr("d", line(means))
        //     .style("stroke","lightgrey")
        //     .style("stroke-width",2)
        //     .style("fill", "none");
        //
        // // Draw the line for each Airport
        // svg.append("path")
        //     .data(keyValue)
        //     .attr("fill", "none")
        //     //.attr("stroke", function(d){ return colorScale(d.key)})
        //     .attr("stroke", d=> {
        //         return(colorScale(d.key));
        //     })
        //     .attr("stroke-width", 1.5)
        //     .attr("d",  d=>line(d.value));
        //
        // //Write the name for each Chart
        // svg.append("text")
        //     .attr("class","airportName")
        //     .attr("text-anchor", "start")
        //     .attr("y", -5)
        //     .attr("x", 0)
        //     .text(function(d){ return((d.key).split(' ').slice(0,2).join(' '))})
        //     .style("fill", function(d){ return colorScale(d.key) })
        //

        let title = legends.append('text')
            .attr('x', 0)
            .attr('y', 0)
            .attr('fill', 'black')
            .attr('font-family', 'Helvetica Neue, Arial')
            .attr('font-weight', 'bold')
            .attr('font-size', '12px')
            .text('Names of Fanfictions');

       let entries = legends
            .data(keyValue)
            .append('circle')
            .attr('cx',5) // <-- offset symbol x-position by radius
            .attr('r', 5)
            .style('fill', d=>colorScale(d.key));

        let labels = entries.data(keyValue)
            .append('text')
            .attr('x',14)
            .attr('y',4)
            .attr('fill', 'black')
            .attr('font-family', 'Helvetica Neue, Arial')
            .attr('font-size', '11px')
            .text(d=>d.key);





    });




</script>

</body>
</html>