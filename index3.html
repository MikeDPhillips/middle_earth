<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500,600" rel="stylesheet">
    <title>Line Chart Raw Count Example</title>
</head>
<body>

<div id="franchiseLine"></div>

<script>
    let margin = {top: 2, right: 30, bottom: 30, left: 60},
        width = 800
        height= 600
        chartWidth = width - margin.left - margin.right,
        chartHeight = height - margin.top - margin.bottom;

    let myGraph = d3.select("#franchiseLine")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("id", "rawLineChart")
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");



    d3.csv("franchises_small.csv",d3.autoType).then((data)=>{

        const filterValues = ["The Lord of the Rings", "The Hobbit"]
        data = data.filter( d => {  return filterValues.indexOf(d['Franchise']) !== -1})
        console.log(data);
        let dateExtent = d3.extent(data, d=>d.Year);
        console.log(dateExtent)
        let countMax = d3.max(data, d=>d.Count)
        let dateScale = d3.scaleLinear().domain(dateExtent).range([margin.left, chartWidth]);
        let countScale = d3.scaleLinear().domain([0, countMax]).range([chartHeight, 0]);
        let yAxis = d3.axisLeft(countScale).ticks();
        let xAxis = d3.axisBottom(dateScale)
            .tickFormat(d3.format("d"))
            .ticks(20)

        myGraph.append("g")
            .attr("transform","translate(" + margin.left + "," + margin.top + ")")
            .call(yAxis);

        myGraph.append("g")
            .attr("transform", "translate("+ margin.left + "," + chartHeight + ")")
            .call(xAxis);


        //Choose colors for each franchise
        let names = [...new Set(data.map(d => d.Franchise))];
        console.log(names)
        let colorScale = d3.scaleOrdinal().domain(names)
            .range(['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#ffbe33','#a65628','#f781bf','#4ec0c2'])


        let sumstat = d3.group(data, d=>d['Franchise'])
        let keyValue = Array.from(sumstat, ([key, value]) => ({key, value}))

        //Line function to chart the line graph
        let line = d3.line()
            .x(function(d){ return dateScale(+d['Year'])})
            .y(function(d){ return countScale(+d['Count'])})


        console.log(keyValue)
        // Draw the line
        let svg = d3.select("#rawLineChart")
        svg.selectAll(".line")
            .data(keyValue)
            .enter()
            .append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .append("path")
            .attr("fill", "none")
            .attr("stroke", function(d){ return colorScale(d.key) })
            .attr("stroke-width", 1.5)
            .attr("d", d => line(d.value))



        // //Add svgs for each chart
        // let svg = d3.select("#myDataViz")
        //     .selectAll("uniqueChart")
        //     .data(keyValue)
        //     .enter()
        //     .append("svg")
        //     .attr("width",width)
        //     .attr("height",height)
        //     .append("g").attr("transform",
        //         "translate(" + margin.left + "," + margin.top + ")")
        //     .attr("id", function(d){ return(d.key)});
        //
        // //Put x and y axis
        // svg.append("g")
        //     .call(yAxis);
        // svg.append("g")
        //     .attr("transform", "translate(0," + chartHeight + ")")
        //     .call(d3.axisBottom(dateScale));
        //
        //
        // svg.append("path")
        //     .attr("class", "mean")
        //     .attr("d", line(means))
        //     .style("stroke","lightgrey")
        //     .style("stroke-width",2)
        //     .style("fill", "none");
        //
        // // Draw the line for each Airport
        // svg.append("path")
        //     .data(keyValue)
        //     .attr("fill", "none")
        //     //.attr("stroke", function(d){ return colorScale(d.key)})
        //     .attr("stroke", d=> {
        //         return(colorScale(d.key));
        //     })
        //     .attr("stroke-width", 1.5)
        //     .attr("d",  d=>line(d.value));
        //
        // //Write the name for each Chart
        // svg.append("text")
        //     .attr("class","airportName")
        //     .attr("text-anchor", "start")
        //     .attr("y", -5)
        //     .attr("x", 0)
        //     .text(function(d){ return((d.key).split(' ').slice(0,2).join(' '))})
        //     .style("fill", function(d){ return colorScale(d.key) })
        //




    });
</script>

</body>
</html>